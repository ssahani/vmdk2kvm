# vmdk2kvm.yaml
# Offline VMware → KVM conversion for openSUSE Leap 15.4
#
# Run with:
#   sudo ./vmdk2kvm.py --config vmdk2kvm.yaml local
#
# What this does:
# - Opens the VMDK offline with libguestfs
# - NEVER mounts using /dev/disk/by-path
# - Rewrites ALL fstab entries to stable UUID= (fallback PARTUUID=)
# - Fixes GRUB root=
# - Regenerates initramfs safely (dracut)
# - Converts final image to qcow2 (compressed)
# - Prints fstab before + after (always)

command: local

# --------------------------------------------------------------------
# Input
# --------------------------------------------------------------------
vmdk: /home/ssahani/by-path/openSUSE_Leap_15.4_VM_LinuxVMImages.COM.vmdk

# --------------------------------------------------------------------
# Output layout
# --------------------------------------------------------------------
output_dir: /home/ssahani/by-path/out

# Flatten snapshot chain first (recommended)
flatten: true
flatten_format: qcow2

# Final output image (relative to output_dir)
to_output: opensuse-leap-15.4-fixed.qcow2
out_format: qcow2
compress: true
checksum: true

# --------------------------------------------------------------------
# Filesystem + boot fixes
# --------------------------------------------------------------------

# ALWAYS show fstab before + after
print_fstab: true

# Rewrite *everything* to stable identifiers:
#   UUID= → PARTUUID= → LABEL=
fstab_mode: stabilize-all

# Update GRUB root=
no_grub: false

# Regenerate initramfs (openSUSE uses dracut)
regen_initramfs: true

# Keep backups inside the guest
no_backup: false

# --------------------------------------------------------------------
# Safety / visibility
# --------------------------------------------------------------------
dry_run: false

# Verbosity:
#   0 = INFO
#   1 = more info
#   2 = DEBUG (recommended when testing)
verbose: 2

# Optional logfile
log_file: /home/ssahani/by-path/out/vmdk2kvm.log

# Optional Markdown report
report: /home/ssahani/by-path/out/vmdk2kvm-report.md

# --------------------------------------------------------------------
# Optional smoke tests (comment out if not needed)
# --------------------------------------------------------------------
# libvirt_test: true
# vm_name: opensuse-leap-15.4-fixed
# memory: 2048
# vcpus: 2
# uefi: false
# timeout: 30
# keep_domain: false
# headless: true

